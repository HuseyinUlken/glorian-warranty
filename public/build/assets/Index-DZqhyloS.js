const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-layout-BmASC0vO.js","assets/app-BV6WKlMb.js","assets/app-D19pQuwB.css","assets/createLucideIcon-Csq-5No8.js","assets/index-Cu2g89jF.js","assets/index-W5Vv9M3c.js","assets/check-B304XM_N.js","assets/badge-C3BjsEuO.js","assets/index.esm-DHvy8tl1.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,a as G,K as X,_ as U,L as ie,S as y}from"./app-BV6WKlMb.js";import{H as ae}from"./heading-DH_H7MeW.js";import{A as E,h as L,a as P,b as H,c as F,d as R,e as $,f as V,g as q}from"./alert-dialog-SNmyHIIT.js";import{B as v}from"./badge-C3BjsEuO.js";import{a as Z,B as f}from"./createLucideIcon-Csq-5No8.js";import{D as se,a as re,b as te,c as ne,d as le}from"./dialog-D4p5782J.js";import{L as oe}from"./loader-circle-nHxdM2Pm.js";import{T as Y}from"./trash-2-Bl4lTKS9.js";import{A as S,b as A,a as C}from"./alert-C9FBxOCD.js";import{C as T,a as _,b as O,d as K,c as M,e as ce}from"./card-BBQXsDsi.js";import{C as D}from"./circle-alert-C8wXAuG0.js";import{C as N}from"./index.esm-DHvy8tl1.js";import{D as de}from"./data-table-CirWy854.js";import{A as me}from"./app-layout-BmASC0vO.js";import{C as J}from"./circle-check-xr_La7n_.js";import{E as ue}from"./eye-CK6JKp87.js";/* empty css            */import"./index-Cu2g89jF.js";import"./table-CX_bukvs.js";import"./input-CJa-cN60.js";import"./scroll-area-DjMf9ZRF.js";import"./index-BdQq_4o_.js";import"./calendar-BaaJbjr3.js";import"./extends-CF3RwP-h.js";import"./check-B304XM_N.js";import"./chevron-up-Df90CaP7.js";import"./chevron-down-D2j7RRd5.js";import"./index-W5Vv9M3c.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],xe=Z("BellOff",he);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],fe=Z("BellRing",pe);function je({notificationId:i,isOpen:t,onClose:g,onDelete:d}){const[r,x]=c.useState(null),[s,l]=c.useState(!1),m=async()=>{if(i){l(!0);try{const p=await G.get(route("notifications.show",i));x(p.data.notification)}catch(p){console.error("Bildirim detayı alınamadı:",p)}finally{l(!1)}}};c.useEffect(()=>{t&&i?m():x(null)},[t,i]);const u=()=>{x(null),g()};return e.jsx(se,{open:t,onOpenChange:u,children:e.jsxs(re,{className:"sm:max-w-md",children:[e.jsxs(te,{children:[e.jsx(ne,{children:"Bildirim Detayı"}),e.jsx(le,{children:"Bildirim içeriği ve detayları"})]}),s?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(oe,{className:"h-8 w-8 animate-spin text-zinc-500"})}):r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:r.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx(v,{variant:"outline",children:r.module_text}),e.jsx(v,{variant:"outline",children:r.event_text})]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx("p",{className:"whitespace-pre-line text-zinc-700",children:r.content})}),e.jsxs("div",{className:"border-t pt-3 text-sm text-zinc-500",children:[e.jsxs("p",{children:["Oluşturulma: ",r.created_at_formatted]}),r.is_read&&e.jsxs("p",{children:["Okunma: ",r.read_at_formatted]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(E,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"text-red-500",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Sil"]})}),e.jsxs(P,{children:[e.jsxs(H,{children:[e.jsx(F,{children:"Bildirimi Sil"}),e.jsx(R,{children:"Bu bildirimi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz."})]}),e.jsxs($,{children:[e.jsx(V,{children:"İptal"}),e.jsx(q,{onClick:()=>{d(r.id),u()},className:"bg-red-500 hover:bg-red-600",children:"Sil"})]})]})]}),e.jsx(f,{onClick:u,children:"Kapat"})]})]}):e.jsx("div",{className:"py-10 text-center text-zinc-500",children:"Bildirim bulunamadı veya yüklenemedi."})]})})}const Q=async()=>{const{initializeApp:i,getApp:t}=await U(async()=>{const{initializeApp:s,getApp:l}=await import("./app-layout-BmASC0vO.js").then(m=>m.G);return{initializeApp:s,getApp:l}},__vite__mapDeps([0,1,2,3,4,5,6,7])),{getMessaging:g,getToken:d,isSupported:r}=await U(async()=>{const{getMessaging:s,getToken:l,isSupported:m}=await import("./index.esm-DHvy8tl1.js").then(u=>u.i);return{getMessaging:s,getToken:l,isSupported:m}},__vite__mapDeps([8,3,1,2,0,4,5,6,7]));return{getMessaging:g,getToken:d,isSupported:r,getOrCreateApp:async s=>{const l=t();return l||i(s)}}};function ge(){const{firebase:i}=X().props,[t,g]=c.useState("default"),[d,r]=c.useState(!1),[x,s]=c.useState(null),[l,m]=c.useState(!1),[u,p]=c.useState(!1),[b,j]=c.useState(null),w=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,z=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone;c.useEffect(()=>{if(w&&!z){j(!1),s("iOS cihazlarda bildirimler yalnızca ana ekrana eklenmiş uygulamalarda desteklenir.");return}const o=async()=>{try{if(!("Notification"in window)){j(!1);return}const{isSupported:h}=await Q(),a=await h();j(a),Notification.permission&&(g(Notification.permission),Notification.permission==="granted"&&k())}catch(h){console.error("Bildirim desteği kontrol edilirken hata oluştu:",h),j(!1)}};i&&i.apiKey&&o()},[i]);const B=async()=>{r(!0),s(null);try{const o=await Notification.requestPermission();g(o),o==="granted"?await k():s("Bildirim izni reddedildi. Bildirimleri alabilmek için tarayıcı ayarlarından izin vermeniz gerekiyor.")}catch(o){console.error("İzin istenirken hata oluştu:",o),s("Bildirim izni istenirken bir hata oluştu. Lütfen tarayıcı ayarlarınızı kontrol edin.")}finally{r(!1)}},k=async()=>{if(!i||!i.apiKey){console.error("Firebase yapılandırması eksik"),s("Firebase yapılandırması eksik. Yönetici ile iletişime geçin.");return}if(w&&!z){s("iOS cihazlarda bildirimler yalnızca ana ekrana eklenmiş uygulamalarda desteklenir.");return}if(!b){s("Tarayıcınız web push bildirimlerini desteklemiyor.");return}try{r(!0);const{getMessaging:o,getToken:h,getOrCreateApp:a}=await Q(),n=await a({apiKey:i.apiKey,authDomain:i.authDomain,projectId:i.projectId,storageBucket:i.storageBucket,messagingSenderId:i.messagingSenderId,appId:i.appId}),ee=o(n),W=await h(ee,{vapidKey:i.vapidKey});W?(await I(W),m(!0),p(!0)):s("Bildirim token'ı alınamadı. Lütfen daha sonra tekrar deneyin.")}catch(o){s(`FCM token alınırken bir hata oluştu: ${o.message}`)}finally{r(!1)}},I=async o=>{try{const h={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenSize:`${window.screen.width}x${window.screen.height}`},a=await G.post(route("fcm-token.store"),{token:o,device_type:"web",device_name:navigator.userAgent.split(" ")[0],device_info:h});a.data.success?(p(!0),m(!0)):(console.error("Token kaydedilirken sunucu hatası:",a.data),s("Token kaydedilirken bir hata oluştu."),p(!1))}catch(h){console.error("Token sunucuya kaydedilirken hata:",h),s("Token sunucuya kaydedilirken bir hata oluştu."),p(!1)}};return b===!1?e.jsxs(T,{className:"mb-6",children:[e.jsxs(_,{children:[e.jsxs(O,{className:"flex items-center",children:[e.jsx(D,{className:"mr-2 h-5 w-5 text-yellow-500"}),"Bildirim Desteği Yok"]}),e.jsx(K,{children:"Tarayıcınız web push bildirimlerini desteklemiyor."})]}),e.jsx(M,{children:e.jsxs(S,{children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(A,{children:"Bildirim Desteği Bulunamadı"}),e.jsx(C,{children:"Kullandığınız tarayıcı veya cihaz web push bildirimlerini desteklemiyor. Bildirimleri alabilmek için Chrome, Firefox, Edge gibi modern bir tarayıcı kullanmanızı öneririz."})]})})]}):!i||!i.apiKey?null:u||t==="granted"?e.jsxs(T,{className:"mb-6",children:[e.jsxs(_,{children:[e.jsxs(O,{className:"flex items-center",children:[e.jsx(N,{className:"mr-2 h-5 w-5 text-green-500"}),"Bildirimler Aktif"]}),e.jsx(K,{children:"Web bildirimleri bu cihaz için aktifleştirildi."})]}),e.jsxs(M,{children:[e.jsxs(S,{className:"border-green-200 bg-green-50 text-green-800 dark:bg-green-800 dark:text-green-200",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(A,{children:"Bildirimler Aktif"}),e.jsx(C,{className:"dark:text-green-200",children:"Artık önemli bildirimleri bu cihazda alabileceksiniz. Bildirimleri kapatmak isterseniz tarayıcı ayarlarından değiştirebilirsiniz."})]}),t==="granted"&&!u&&e.jsx("div",{className:"mt-4",children:e.jsx(f,{onClick:k,disabled:d,className:"w-full",children:d?"İşleniyor...":"Tokenı Yenile"})})]})]}):e.jsxs(T,{className:"mb-6",children:[e.jsxs(_,{children:[e.jsxs(O,{className:"flex items-center",children:[e.jsx(fe,{className:"mr-2 h-5 w-5 text-blue-500"}),"Web Bildirimleri"]}),e.jsx(K,{children:"Önemli bildirimleri tarayıcınızda almak için izin verin."})]}),e.jsxs(M,{children:[x&&e.jsxs(S,{variant:"destructive",className:"mb-4",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(A,{children:"Hata"}),e.jsx(C,{children:x})]}),l&&e.jsxs(S,{className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(A,{children:"Başarılı"}),e.jsx(C,{children:"Bildirim izni başarıyla alındı ve token kaydedildi."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Bildirim Durumu"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t==="granted"?e.jsxs("span",{className:"flex items-center text-green-500",children:[e.jsx(N,{className:"mr-1 h-4 w-4"})," İzin Verildi"]}):t==="denied"?e.jsxs("span",{className:"flex items-center text-red-500",children:[e.jsx(xe,{className:"mr-1 h-4 w-4"})," İzin Reddedildi"]}):e.jsxs("span",{className:"flex items-center text-yellow-500",children:[e.jsx(D,{className:"mr-1 h-4 w-4"})," İzin Bekleniyor"]})})]}),t!=="granted"&&e.jsx(f,{onClick:B,disabled:d||t==="denied",children:d?"İşleniyor...":"Bildirimlere İzin Ver"}),t==="granted"&&!u&&e.jsx(f,{onClick:k,disabled:d,children:d?"İşleniyor...":"Token Kaydet"})]})]}),e.jsx(ce,{className:"text-muted-foreground text-xs",children:t==="denied"?e.jsx("p",{children:"Bildirimlere izin vermek için tarayıcı ayarlarınızı değiştirmeniz gerekiyor. Adres çubuğundaki kilit simgesine tıklayarak site ayarlarına erişebilirsiniz."}):e.jsx("p",{children:"Bildirimlere izin vererek, önemli güncellemeler, yeni mesajlar ve diğer kritik bilgileri anında alabilirsiniz."})})]})}const ke=[{title:"home",href:route("dashboard")},{title:"Bildirimler",href:route("notifications.index")}];function We({dataTableMeta:i,unreadCount:t,flash:g}){const d=i.data.data,[r,x]=c.useState(null),[s,l]=c.useState(!1),{auth:m,firebase:u}=X().props,[p,b]=c.useState(null);c.useEffect(()=>{const a=async()=>{try{const n=await G.get(route("fcm-token.check"));b(n.data.hasToken)}catch(n){console.error("Token kontrolü yapılırken hata oluştu:",n),b(!1)}};m.user&&a()},[]);const j=()=>{y.reload()},w=a=>{y.post(route("notifications.mark-as-read",a),{},{preserveScroll:!0,onSuccess:j})},z=()=>{y.post(route("notifications.mark-all-as-read"),{},{preserveScroll:!0,onSuccess:j})},B=a=>{y.delete(route("notifications.destroy",a),{preserveScroll:!0,onSuccess:j})},k=()=>{y.delete(route("notifications.destroy-all"),{preserveScroll:!0,onSuccess:j})},I=a=>{x(a),l(!0)},o=()=>{l(!1),x(null),y.reload()},h=[{accessorKey:"title",header:"Başlık",cell:({row:a})=>{const n=a.original;return e.jsx("div",{className:`${n.is_read?"":"font-semibold"}`,children:n.title})}},{accessorKey:"module_text",header:"Modül"},{accessorKey:"event_text",header:"Olay",cell:({row:a})=>{const n=a.original;return e.jsx(v,{variant:"outline",children:n.event_text})}},{accessorKey:"created_at_formatted",header:"Tarih"},{accessorKey:"is_read",header:"Durum",cell:({row:a})=>a.original.is_read?e.jsxs(v,{variant:"outline",className:"bg-green-50 dark:bg-green-800",children:[e.jsx(J,{className:"mr-1 h-3.5 w-3.5 text-green-500"}),"Okundu"]}):e.jsx(v,{variant:"outline",className:"bg-blue-50 dark:bg-blue-800",children:"Okunmadı"})},{id:"actions",header:"İşlemler",cell:({row:a})=>{const n=a.original;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>I(n.id),title:"Detayları Görüntüle",children:e.jsx(ue,{className:"h-4 w-4 text-blue-500"})}),!n.is_read&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>w(n.id),title:"Okundu Olarak İşaretle",children:e.jsx(N,{className:"h-4 w-4 text-green-500"})}),e.jsxs(E,{children:[e.jsx(L,{asChild:!0,children:e.jsx(f,{variant:"outline",size:"sm",className:"text-red-500",title:"Sil",children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsxs(P,{children:[e.jsxs(H,{children:[e.jsx(F,{children:"Bildirimi Sil"}),e.jsx(R,{children:"Bu bildirimi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz."})]}),e.jsxs($,{children:[e.jsx(V,{children:"İptal"}),e.jsx(q,{onClick:()=>B(n.id),className:"bg-red-500 hover:bg-red-600",children:"Sil"})]})]})]})]})}}];return e.jsxs(me,{breadcrumbs:ke,children:[e.jsx(ie,{title:"Bildirimler"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[m.user&&u&&p===!1&&e.jsx(ge,{}),e.jsx(ae,{title:"Bildirimler",description:"Bildirimleri yönetmek için bu tabloyu kullanabilirsiniz.",buttons:e.jsxs("div",{className:"flex space-x-2",children:[t>0&&e.jsxs(f,{variant:"outline",onClick:z,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Tümünü Okundu İşaretle"]}),e.jsxs(E,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"text-red-500",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Tüm Bildirimleri Sil"]})}),e.jsxs(P,{children:[e.jsxs(H,{children:[e.jsx(F,{children:"Tüm Bildirimleri Sil"}),e.jsx(R,{children:"Tüm bildirimleri silmek istediğinizden emin misiniz? Bu işlem geri alınamaz."})]}),e.jsxs($,{children:[e.jsx(V,{children:"İptal"}),e.jsx(q,{onClick:k,className:"bg-red-500 hover:bg-red-600",children:"Tümünü Sil"})]})]})]})]})}),e.jsxs(T,{children:[e.jsxs(_,{children:[e.jsx(O,{children:"Bildirim Listesi"}),e.jsx(K,{children:"Tüm bildirimlerinizi buradan görüntüleyebilir ve yönetebilirsiniz."})]}),e.jsx(M,{children:d.length===0?e.jsx("div",{className:"py-10 text-center text-zinc-500",children:"Henüz bildiriminiz bulunmuyor."}):e.jsx(de,{columns:h,data:d,meta:i.meta,routeName:"notifications.index",searchKey:"title",keepAlive:!0,reloadProps:["notifications","dataTableMeta"]})})]}),e.jsx(je,{notificationId:r,isOpen:s,onClose:o,onDelete:B})]})]})}export{We as default};
